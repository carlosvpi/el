const noop=()=>{},id=t=>t,apply=t=>t(),getRandomId=()=>Math.random().toString(16).slice(2);class El{constructor(t){this.node=t,this.DomEventHandlers={mount:apply,unmount:apply,beforeMount:noop,beforeUnmount:noop,afterMount:noop,afterUnmount:noop},this._children=[...t.children].map(t=>new El(t))}tap(t){return t(this),this}on(t,e,i){return["mount","unmount","beforeMount","beforeUnmount","afterMount","afterUnmount"].includes(t)?this.DomEventHandlers[t]=e:this.node.addEventListener(t,e,i),this}attr(t,e){return"function"==typeof e?(e(e=>this.attr(t,e),this),this):"function"==typeof t?(t(([t,e])=>this.attr(t,e),this),this):null===e||!1===e?(this.node.removeAttribute(t),this):void 0===e?this.node.getAttribute(t):(this.node.setAttribute(t,e),this)}attrs(t){return void 0===t?Object.fromEntries(this.node.getAttributeNames().map(t=>[t,this.node.getAttribute(t)])):(Object.keys(t).forEach(e=>{this.attr(e,t[e])}),this)}prop(t,e){return"function"==typeof e?(e(e=>this.prop(t,e),this),this):"function"==typeof t?(t(([t,e])=>this.prop(t,e),this),this):null===e?(delete this.node[t],this):void 0===e?this.node[t]:(this.node[t]=e,this)}props(t){return void 0===t?this.node:(Object.keys(t).forEach(e=>{this.prop(e,t[e])}),this)}classed(t,e){return"function"==typeof e?(e(e=>this.classed(t,e),this),this):"function"==typeof t?(t(([t,e])=>this.classed(t,e),this),this):!1===e?(this.node.classList.remove(t),this):void 0===e?this.node.classList.has(t):(this.node.classList.add(t),this)}classes(t){return void 0===t?[...this.node.classList]:(Object.keys(t).forEach(e=>{this.classed(e,t[e])}),this)}child(t,e){if("function"==typeof e)return e(e=>this.child(t,e),this),this;if("function"==typeof t)return t(([t,e])=>this.child(t,e),this),this;if(!1===e||e<0){const e=this._children.indexOf(t);if(e>=0){const t=this._children[e];this._children[e]=void 0,t&&t.unmount(this)}return this}if(void 0===e)return this._children.indexOf(t);if(!t&&void 0!==e){if(void 0!==this._children[e]){const t=this._children[e];this._children[e]=void 0,t&&t.unmount(this)}return this}if(this._children.indexOf(t)!==e){const i=this._children.indexOf(t);i>=0&&(this._children[i]=void 0);const n=this._children[e];this._children[e]=t,n&&n.unmount(this),-1===i&&t.mount(this)}return this}children(...t){return"function"==typeof t[0]?(t[0](t=>this.children(...t)),this):(t.reverse().forEach((e,i)=>{e&&this.child(e,t.length-i-1)}),this._children.filter(e=>!t.includes(e)).forEach(t=>{this.child(t,-1)}),this)}unmount(t){return this.node.parentNode!==t.node?this:(this.DomEventHandlers.unmount(()=>new Promise((e,i)=>{try{if(t._children.includes(this))return void e(!1);this.DomEventHandlers.beforeUnmount(this),t.node.removeChild(this.node),setTimeout(()=>{this.DomEventHandlers.afterUnmount(this),e(!0)},0)}catch(t){i(t)}}),this),this)}mount(t){return this.DomEventHandlers.mount(()=>new Promise((e,i)=>{try{if(!t._children.includes(this))return void e(!1);this.DomEventHandlers.beforeMount(this);const n=t._children.indexOf(this),s=t._children.slice(n+1).find(t=>void 0!==t);s?t.node.insertBefore(this.node,s.node):t.node.appendChild(this.node),setTimeout(()=>{this.DomEventHandlers.afterMount(this),e(!0)},0)}catch(t){i(t)}}),this),this}}Text=t=>new El(document.createTextNode(t)),el=(...t)=>new El("string"==typeof t[0]?document.createElement(...t):t[0]),"undefined"!=typeof module&&(module.exports=el,module.exports.Text=Text,module.exports.getRandomId=getRandomId);
